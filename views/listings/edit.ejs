<% layout("layouts/boilerplate.ejs") -%>

<section class="page page-form">
  <div class="form-card">
    <h1>Edit listing</h1>

    <form
      action="/listings/<%= listing._id %>?_method=PUT"
      method="POST"
      novalidate
      class="form-vertical"
      enctype="multipart/form-data"
    >
      <!-- Title -->
      <div class="form-field">
        <label for="title">Title *</label>
        <input
          id="title"
          type="text"
          name="title"
          placeholder="Add a catchy title"
          required
          value="<%= listing.title %>"
        />
      </div>

      <!-- Description -->
      <div class="form-field">
        <label for="description">Description *</label>
        <textarea
          id="description"
          name="description"
          required
        ><%= listing.description %></textarea>
      </div>

      <!-- Categories -->
      <div class="form-field">
        <label>Select categories</label>
        <div class="category-container">
          <% categories.forEach(function(cat) { %>
          <label class="category-option">
            <input
              type="checkbox"
              name="categories"
              value="<%= cat %>"
              <%= listing.categories.includes(cat) ? "checked" : "" %>
            />
            <span><%= cat %></span>
          </label>
          <% }) %>
        </div>
      </div>

      <!-- Image -->
      <div class="form-field">
        <label for="image">Update image</label>
        <input id="image" type="file" name="listing[image]" accept="image/*" />
        <% if (listing.image && listing.image.url) { %>
        <div class="current-image">
          <p class="current-image-label">Current image:</p>
          <img
            src="<%= listing.image.url %>"
            alt="Current listing image"
            class="current-image-preview"
          />
        </div>
        <% } %>
      </div>

      <!-- Price, Location, Country -->
      <div class="form-row">
        <div class="form-field">
          <label for="price">Price *</label>
          <input
            id="price"
            type="number"
            name="price"
            min="500"
            required
            value="<%= listing.price %>"
          />
        </div>

        <div class="form-field">
          <label for="location">Location *</label>
          <input
            id="location"
            type="text"
            name="location"
            required
            value="<%= listing.location %>"
          />
        </div>

        <div class="form-field">
          <label for="country">Country *</label>
          <input
            id="country"
            type="text"
            name="country"
            required
            value="<%= listing.country %>"
          />
        </div>
      </div>

      <!-- Submit -->
      <div class="form-actions">
        <button type="submit" class="btn-primary">Update listing</button>
      </div>
    </form>
  </div>
</section>
