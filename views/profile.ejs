<% layout("layouts/boilerplate.ejs") -%>

<section class="page page-profile">
  <div class="profile-card">
    <!-- User Info Section -->
    <header class="profile-header">
      <div class="profile-header-bar"></div>
      <div class="profile-header-text">
        <h1>My Profile</h1>
        <p class="profile-subtitle">Account Information & Booking History</p>
      </div>
    </header>

    <div class="profile-body">
      <!-- User Information -->
      <section class="profile-section">
        <h2 class="profile-section-title">Account Information</h2>
        <div class="profile-info">
          <div class="profile-info-item">
            <span class="profile-info-label">Username:</span>
            <span class="profile-info-value">@<%= user.username %></span>
          </div>
          <div class="profile-info-item">
            <span class="profile-info-label">Email:</span>
            <span class="profile-info-value"><%= user.email %></span>
          </div>
        </div>
        <div class="profile-actions" style="margin-top: 1.5rem">
          <a href="/profile/edit" class="btn-primary btn-inline"
            >Edit Username</a
          >
        </div>
      </section>

      <hr class="profile-divider" />

      <!-- Booking History -->
      <section class="profile-section">
        <h2 class="profile-section-title">My Bookings</h2>

        <% if (bookings.length === 0) { %>
        <div class="profile-empty-state">
          <p>You haven't made any bookings yet.</p>
          <a href="/listings" class="btn-primary btn-inline">Browse Listings</a>
        </div>
        <% } else { %>
        <div class="bookings-grid">
          <% for (const booking of bookings) { %>
          <article class="booking-card">
            <!-- Listing Image -->
            <div class="booking-image-wrapper">
              <% if (booking.listing && booking.listing.image &&
              booking.listing.image.url) { %>
              <img
                src="<%= booking.listing.image.url %>"
                alt="<%= booking.listing.title %>"
                class="booking-image"
              />
              <% } else { %>
              <!-- fallback if listing deleted -->
              <img
                src="/images/placeholder.jpg"
                alt="Listing deleted"
                class="booking-image"
              />
              <% } %>
            </div>

            <!-- Booking Details -->
            <div class="booking-content">
              <h3 class="booking-title">
                <%= booking.listing ? booking.listing.title : "Listing Deleted"
                %>
              </h3>

              <div class="booking-location">
                <i class="bi bi-geo-alt-fill"></i>
                <span>
                  <%= booking.listing ? `${booking.listing.location},
                  ${booking.listing.country}` : "N/A" %>
                </span>
              </div>

              <div class="booking-dates">
                <div class="booking-date-item">
                  <span class="booking-date-label">Check-in:</span>
                  <span class="booking-date-value">
                    <%= new Date(booking.checkIn).toLocaleDateString('en-IN', {
                    year: 'numeric', month: 'short', day: 'numeric' }) %>
                  </span>
                </div>
                <div class="booking-date-item">
                  <span class="booking-date-label">Check-out:</span>
                  <span class="booking-date-value">
                    <%= new Date(booking.checkOut).toLocaleDateString('en-IN', {
                    year: 'numeric', month: 'short', day: 'numeric' }) %>
                  </span>
                </div>
              </div>

              <div class="booking-meta">
                <div class="booking-meta-item">
                  <span class="booking-meta-label">Guest Name:</span>
                  <span class="booking-meta-value"><%= booking.name %></span>
                </div>
                <div class="booking-meta-item">
                  <span class="booking-meta-label">Mobile:</span>
                  <span class="booking-meta-value"><%= booking.mobile %></span>
                </div>
              </div>

              <div class="booking-footer">
                <div class="booking-price">
                  <span class="booking-price-label">Total Price:</span>
                  <span class="booking-price-value">
                    â‚¹<%= booking.totalPrice.toLocaleString('en-IN') %>
                  </span>
                </div>
                <div class="booking-date">
                  <span class="booking-date-label">Booked on:</span>
                  <span class="booking-date-value">
                    <%= new Date(booking.createdAt).toLocaleDateString('en-IN',
                    { year: 'numeric', month: 'short', day: 'numeric' }) %>
                  </span>
                </div>
              </div>

              <div class="booking-payment">
                <i class="bi bi-cash-coin"></i>
                <span>Cash on Counter</span>
              </div>
            </div>
          </article>
          <% } %>
        </div>
        <% } %>
      </section>
    </div>
  </div>
</section>
